{{page-title "Game"}}
<div>
    <div>
        {{#if this.started}}
            <p>Game has started!</p>
        {{/if}}
        {{#if this.over}}
            <p>Game is OVER!</p>
        {{/if}}
            <button type="button" {{on 'click' this.startGame}}>Start Game</button>
    </div>
    <div>
        <h2>Game Data</h2>
        <p>Name: {{this.model.gameState.gameName}}</p>
        <div class="players">
            {{#each this.otherPlayers as |player|}}
                <Player @playerData={{player}} @cards={{player.cards}} @loadId={{this.loadId}} @highlight={{(eq this.selectedPlayerId player.id)}}/>            
            {{/each}}
        </div>
    </div>
    <div>
        {{#if this.promptBlock}}
            <h2>Block State</h2>
            {{#each this.blockState.pendingPlayerIds as |pendingPlayerId|}}
                <p>Pending player: {{pendingPlayerId}}</p>
            {{/each}}
            <p>Action: {{this.blockState.actionId}}</p>
            <p>Source: {{this.blockState.sourceId}}</p>
            <p>Target: {{this.blockState.targetId}}</p>
            {{#each this.blockState.blockCards as |blockCard|}}
                <button type="button" {{on 'click' (fn this.block blockCard.id)}}>Block as {{blockCard.name}}</button>
            {{/each}}
            <button type="button" {{on 'click' this.passBlock}}>Allow</button>
        {{/if}}
        {{#if this.promptChallenge}}
            <h2>Challenge State</h2>
            {{#each this.challengeState.pendingPlayerIds as |pendingPlayerId|}}
                <p>Pending player: {{pendingPlayerId}}</p>
            {{/each}}
            <p>Action: {{this.challengeState.actionId}}</p>
            <p>Source: {{this.challengeState.sourceId}}</p>
            <p>Target: {{this.challengeState.targetId}}</p>
            <p>Card Claimed: {{this.challengeState.cardClaimed.name}}</p>
            <button type="button" {{on 'click' this.challenge}}>Challenge</button>
            <button type="button" {{on 'click' this.passChallenge}}>Pass</button>
        {{/if}}
        {{#if this.promptRevealCard}}
            <h2>Reveal Card State (if you have been challenged)</h2>
            {{#each this.cards as |card|}}
                {{#unless card.revealed}}
                    <button type="button" {{on 'click' (fn this.revealCard card.id)}}>Reveal {{card.name}}</button>
                {{/unless}}
            {{/each}}
        {{/if}}
        {{#if this.promptLoseInfluenceState}}
            <h2>Lose Influence State</h2>
            {{#each this.cards as |card|}}
                {{#unless card.revealed}}
                    <button type="button" {{on 'click' (fn this.loseInfluence card.id)}}>Card: {{card.name}}</button>
                {{/unless}}
            {{/each}}
        {{/if}}
        {{#if this.promptExchangeState}}
            <h2>Exchange State</h2>
            <div>Exchange state active!</div>
            <button type="button" {{on 'click' this.handleConfirmExchange}}>Confirm Exchange</button>
            <div>New cards:</div>
            {{#each this.exchangeCards as |card|}}
                <button type="button" {{on 'click' (fn this.selectCard card.id)}}>Ex card: {{card.name}}</button>
            {{/each}}
            <div>Your current cards:</div>
            {{#each this.cards as |card|}}
                {{#unless card.revealed}}
                    <button type="button" {{on 'click' (fn this.selectCard card.id)}}>Cur card: {{card.name}}</button>
                {{/unless}}
            {{/each}}
        {{/if}}
    </div>
    <div>
        <h2>You</h2>
        <div class="client-data">
            <Player @playerData={{this.player}} @cards={{this.cards}} @self={{true}} @loadId={{this.loadId}} @highlight={{false}}/>
        </div>
    </div>
    <div>

        {{#if (eq this.model.playerId this.currentTurnPlayerId)}}
            {{#each this.actions as |action|}}
                <button type="button" {{on 'click' (fn this.initiateAction action)}}>{{action.name}}</button>
            {{/each}}
        {{/if}}
        <div>
            <br>
            <br>
            End of file
        </div>
    </div>
</div>